
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GeoJSON, Turf.js, and Google Maps Example</title>
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADd7NKHfGXY1FLZn4z260m0pwnhFcA1gE&libraries=places"></script>
    <style>
        body {
            display: flex;
        }
        #searchContainer {
            width: 50%;
            display: flex;
            flex-direction: column;
            height: 10vh; /* Full height of the viewport */
            padding: 10px;
            justify-content: flex-start; /* Aligns content to the top */
        }
        #map {
            height: 100vh; /* Full height of the viewport */
            width: 50%;
        }
        #searchBox {
            width: 100%;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            background-color: white;
            padding: 12px 20px 12px 40px;
            margin-bottom: 10px; /* Space between search box and button */
        }
        #checkLocationBtn {
            margin-top: auto; /* Pushes the button to the bottom */
        }
    </style>
</head>
<body>
<div id="searchContainer">
    <input id="searchBox" type="text" placeholder="Enter an address...">
    <button id="checkLocationBtn">Check My Location</button>
</div>
<div id="map"></div>
<script>
    let map, marker, geoJsonData;

    async function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: { lat: 29.7604, lng: -95.3698 } // Default center (e.g., Houston, TX)
        });

        // 1776 Gessner Rd, Houston, TX 77080 outside bounds
        // 4701 Dickson St, Houston, TX 77007 within bounds


        // Fetch and display GeoJSON overlay
        geoJsonData = await fetchGeoJson('https://raw.githubusercontent.com/jeffrey840/zipcode_2/main/Hcc_districts_Geojson/merged_districts.geojson');
        if (geoJsonData) {
            map.data.addGeoJson(geoJsonData);
        }
    }

    async function fetchGeoJson(url) {
        try {
            const response = await fetch(url);
            return await response.json();
        } catch (error) {
            console.error("Error fetching GeoJSON data:", error);
            return null;
        }
    }

    async function checkPointInGeoJsonPolygon(geoJsonData, pointCoordinates) {
        if (geoJsonData && geoJsonData.features) {
            const polygon = geoJsonData.features[0].geometry;
            const point = turf.point(pointCoordinates);
            const isInside = turf.booleanPointInPolygon(point, polygon);

            if (!marker) {
                // Initialize the marker when first needed
                marker = new google.maps.Marker({
                    position: { lat: pointCoordinates[1], lng: pointCoordinates[0] },
                    map: map,
                    title: 'Point Location'
                });
            } else {
                // Update the marker's position
                marker.setPosition({ lat: pointCoordinates[1], lng: pointCoordinates[0] });
            }

            alert(isInside ? "is within bounds" : "outside bounds");
        } else {
            alert('Failed to load or process GeoJSON data.');
        }
    }

    async function handleSearchInput(e) {
        if (e.key === 'Enter') {
            const address = document.getElementById('searchBox').value;
            const geocoder = new google.maps.Geocoder();

            try {
                const location = await geocodeAddress(geocoder, address);
                const pointCoordinates = [location.lng(), location.lat()];

                // Ensure GeoJSON data is loaded before proceeding
                if (geoJsonData) {
                    checkPointInGeoJsonPolygon(geoJsonData, pointCoordinates);
                } else {
                    alert("GeoJSON data is not yet loaded. Please try again.");
                }
            } catch (error) {
                alert(error);
            }
        }
    }

    async function geocodeAddress(geocoder, address) {
        return new Promise((resolve, reject) => {
            geocoder.geocode({ 'address': address }, (results, status) => {
                if (status === 'OK') {
                    resolve(results[0].geometry.location);
                } else {
                    reject('Geocode was not successful for the following reason: ' + status);
                }
            });
        });
    }

    function getUserLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((position) => {
                const pointCoordinates = [position.coords.longitude, position.coords.latitude];
                checkPointInGeoJsonPolygon(geoJsonData, pointCoordinates);
            }, () => {
                alert('Error getting your location.');
            });
        } else {
            alert('Geolocation is not supported by this browser.');
        }
    }


    document.getElementById('searchBox').addEventListener('keydown', handleSearchInput);
    document.getElementById('checkLocationBtn').addEventListener('click', getUserLocation);
    initMap();
</script>
</body>
</html>
