<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Property Listings V2</title>
	<!-- Import Google Maps JS API -->
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADd7NKHfGXY1FLZn4z260m0pwnhFcA1gE&callback=initialize" async defer></script>
	<style>
        /* Add CSS styles for new UI components */
        .filter-container {
            margin-bottom: 20px;
        }

        .filter-container select, .filter-container input {
            margin-right: 10px;
        }

        #map {
            height: 500px;
            width: 100%;
        }

        .toggle-buttons {
            margin-bottom: 10px;
        }
	</style>
</head>
<body>

<!-- Filters for searching properties -->
<!-- Filters for searching properties -->
<div class="filter-container">
	<input type="text" id="location" placeholder="Location (Zip Code)">
	<input type="number" id="page" placeholder="Page" max="20">
	<select id="statusType">
		<option value="">Status Type</option>
		<option value="ForSale">For Sale</option>
		<option value="ForRent">For Rent</option>
		<option value="RecentlySold">Recently Sold</option>
	</select>
	<input type="text" id="homeType" placeholder="Home Type">
	<input type="text" id="sort" placeholder="Sort Criteria">

	<select id="propertyType">
		<option value="">All Types</option>
		<option value="Houses">Houses</option>
		<option value="Condos">Condos</option>
		<option value="Townhomes">Townhomes</option>
		<option value="Apartments_Condos_Co-ops">Apartments/Condos/Co-ops</option>
		<option value="Multi-family">Multi-family</option>
		<option value="Apartments">Apartments</option>
		<option value="Manufactured">Manufactured</option>
		<option value="LotsLand">Lots/Land</option>
	</select>

	<input type="number" id="minPrice" placeholder="Min Price">
	<input type="number" id="maxPrice" placeholder="Max Price">
	<input type="number" id="bedsMin" placeholder="Min Beds">
	<input type="number" id="bedsMax" placeholder="Max Beds">
	<button onclick="applyFilters()">Search</button>
</div>

<!-- Toggle buttons for map markers -->
<div class="toggle-buttons">
	<button onclick="toggleMarkers(true)">Show Markers</button>
	<button onclick="toggleMarkers(false)">Hide Markers</button>
</div>

<!-- UI buttons to allow user to fetch houses by zipcode -->
<div id="zipcodeButtons">
	<button onclick="fetchHouses('77080', 1)">77080</button>
	<button onclick="fetchHouses('77056', 1)">77056</button>
</div>

<!-- Map component where houses will be plotted -->
<div id="map"></div>

<!-- Pagination component for handling multiple pages of house data -->
<div id="pagination"></div>

<script>
	let map;
	let markers = []; // Array to store map markers
	let currentZipCode = '77080';

	function initialize() {
		// Initialize map with default location and settings
		map = new google.maps.Map(document.getElementById('map'), {
			center: { lat: 29.8131, lng: -95.4648 },
			zoom: 12
		});
	}


	// Fetches houses from the Zillow API with the specified filters
	async function fetchHouses(zipCode) {
		const apiKey = '206a0782demsh5a1d5a242226a6dp1f6b6cjsnf08b18ac4dfa'; // Replace with your Zillow API key
		const options = {
			method: 'GET',
			headers: {
				'X-RapidAPI-Key': apiKey,
				'X-RapidAPI-Host': 'zillow-com1.p.rapidapi.com'
			}
		};
		const location = document.getElementById('location').value || '77080';
		const page = document.getElementById('page').value || 1;
		const statusType = document.getElementById('statusType').value;
		const homeType = document.getElementById('homeType').value;
		const sort = document.getElementById('sort').value;
		const minPrice = document.getElementById('minPrice').value;
		const maxPrice = document.getElementById('maxPrice').value;
		const propertyType = document.getElementById('propertyType').value;
		const bedsMin = document.getElementById('bedsMin').value;
		const bedsMax = document.getElementById('bedsMax').value;

		// Construct URL with filters
		let url = `https://zillow-com1.p.rapidapi.com/propertyExtendedSearch?location=${location}&page=${page}`;
		if (statusType) url += `&status_type=${statusType}`;
		if (homeType) url += `&home_type=${homeType}`;
		if (sort) url += `&sort=${sort}`;
		if (minPrice) url += `&minPrice=${minPrice}`;
		if (maxPrice) url += `&maxPrice=${maxPrice}`;
		if (propertyType) url += `&home_type=${propertyType}`;
		if (bedsMin) url += `&beds_min=${bedsMin}`;
		if (bedsMax) url += `&beds_max=${bedsMax}`;

		// Log the URL and options
		console.log("Request URL:", url);
		console.log("Request Options:", options);
		try {
			const response = await fetch(url, options);
			const data = await response.json();

			if (data && data.props) {
				// Filtering out properties without latitude or longitude
				const validProperties = data.props.filter(house => house.latitude && house.longitude);

				displayHousesOnMap(validProperties);
			}
		} catch (error) {
			console.error('Error fetching data from Zillow API:', error);
		}
	}



	// Applies user-selected filters and fetches houses
	function applyFilters() {
		fetchHouses();
	}

	// Toggles the visibility of markers on the map
	function toggleMarkers(show) {
		markers.forEach(marker => marker.setMap(show ? map : null));
	}

	// Modify initMap to store markers in the markers array
	function initMap(properties = []) {
		markers.forEach(marker => marker.setMap(null)); // Clear existing markers
		markers = [];

		properties.forEach(property => {
			let marker = new google.maps.Marker({
				position: { lat: property.latitude, lng: property.longitude },
				map: map
			});
			markers.push(marker);
		});
	}

	function displayHousesOnMap(houses) {
		markers.forEach(marker => marker.setMap(null)); // Clear existing markers
		markers = [];

		houses.forEach(house => {
			let marker = new google.maps.Marker({
				position: { lat: house.latitude, lng: house.longitude },
				map: map,
				title: house.address // Example: showing address on hover
			});
			markers.push(marker);
		});
	}




</script>
</body>
</html>
