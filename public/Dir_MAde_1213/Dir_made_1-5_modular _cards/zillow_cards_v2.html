<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Zillow Listings 6</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADd7NKHfGXY1FLZn4z260m0pwnhFcA1gE&callback=initMap" async defer></script>
</head>
<body>

<div class="container-fluid" style="font-family: 'Lato', sans-serif;">

	<!-- Navbar with Search Bar -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid">
			<!-- For Sale Dropdown -->
			<ul class="navbar-nav me-auto mb-2 mb-lg-0">
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="dropdown-title" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						For Sale
					</a>
					<ul class="dropdown-menu" aria-labelledby="dropdown-title">
						<li><a class="dropdown-item" href="#" onclick="updateSaleTitle('ForSale')">For Sale</a></li>
						<li><a class="dropdown-item" href="#" onclick="updateSaleTitle('ForRent')">For Rent</a></li>
						<li><a class="dropdown-item" href="#" onclick="updateSaleTitle('RecentlySold')">Sold</a></li>
					</ul>
				</li>
			</ul>
			<form class="d-flex">
				<input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
				<button class="btn btn-outline-success" type="submit">Search</button>
			</form>

			<!-- Price Range Dropdown -->
			<ul class="navbar-nav">
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="price-range-title" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						Price Range
					</a>
					<div class="dropdown-menu">
						<form id="price-range-form">
							<label for="min-price">Minimum</label>
							<input type="number" id="min-price" placeholder="Enter number">
							<label for="max-price">Maximum</label>
							<select id="max-price">
								<!-- Options added via JavaScript -->
							</select>
							<button type="button" onclick="applyPriceRange()">Apply</button>
						</form>
					</div>
				</li>
			</ul>

			<!-- Beds & Baths Dropdown -->
			<ul class="navbar-nav">
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="beds-baths-title" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						Beds & Baths
					</a>
					<div class="dropdown-menu" style="width: 300px;">
						<div class="px-4 py-3" id="bedroom-options">
							<!-- Bedroom option buttons (Unchanged) -->
							<span>Bedrooms:</span>
							<div class="d-flex flex-wrap">
								<!-- Bathroom option buttons updated to call filterByBathrooms -->
								<button class="btn btn-outline-secondary m-1 btn-sm-1" onclick="filterByBedrooms('any')">Any</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBedrooms(1)">1</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBedrooms(2)">2</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBedrooms(3)">3</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBedrooms(4)">4</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBedrooms(5)">5</button>
							</div>
						</div>
						<div class="px-4 py-3" id="bathroom-options">
							<span>Bathrooms:</span>
							<div class="d-flex flex-wrap">
								<!-- Bathroom option buttons updated to call filterByBathrooms -->
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBathrooms('any')">Any</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBathrooms(1)">1</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBathrooms(2)">2</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBathrooms(3)">3</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBathrooms(4)">4</button>
								<button class="btn btn-outline-secondary  btn-sm-1" onclick="filterByBathrooms(5)">5</button>
							</div>
						</div>
						<div class="d-flex justify-content-center p-2">
							<button type="button" class="btn btn-primary" onclick="applyBedsBaths()">Apply</button>
						</div>
					</div>
				</li>
			</ul>

			<!-- Home Type Dropdown -->
			<ul class="navbar-nav">
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="home-type-title" role="button" data-bs-toggle="dropdown" aria-expanded="false">
						Home Type
					</a>
					<div class="dropdown-menu">
						<form class="px-4 py-3" id="home-type-form">
							<div class="mb-3">
								<label>
									<input type="radio" name="select-all" onclick="toggleSelectAll(true)"> Select All
								</label>
								<label>
									<input type="radio" name="select-all" onclick="toggleSelectAll(false)"> Deselect All
								</label>
							</div>
							<div>
								<label class="form-check">
									<input type="checkbox" class="form-check-input" name="home-type" value="SINGLE_FAMILY" onclick="updateHomeType()" checked> House
								</label>
								<label class="form-check">
									<input type="checkbox" class="form-check-input" name="home-type" value="TOWNHOUSE" onclick="updateHomeType()" checked> Town Home
								</label>
								<!-- Additional checkboxes for other home types, all checked -->
							</div>
							<button type="button" class="btn btn-primary" onclick="applyHomeType()">Apply</button>
						</form>
					</div>
				</li>
			</ul>
		</div>
	</nav>

	<!-- Row for Cards and Map -->
	<div class="row">
		<!-- Left Column with Cards -->
		<div class="col-md-6" style="height: 100vh">
			<!-- Scrollable area for cards -->
			<div class="overflow-y-auto h-100">
				<div style="display: grid; grid-template-columns: repeat(2, 1fr); grid-gap: 10px;" id="card-container" >
					<!-- Cards will be dynamically loaded here -->
				</div>
				<div>
					<button onclick="previousPage()">Previous</button>
					<button onclick="nextPage()">Next</button>
				</div>
			</div>
		</div>

		<!-- Right Column with Map -->
		<div class="col-md-6">
			<div id="map-container" style="height: 100vh;">
				<!-- Map will be displayed here -->
			</div>
		</div>
	</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

	$(document).ready(function() {
		const maxPriceSelect = $('#max-price');
		for (let i = 50000; i <= 1000000; i += 50000) {
			maxPriceSelect.append($('<option>', { value: i, text: `$${i.toLocaleString()}` }));
		}
	});

	let currentDisplayData = [];
	let filteredData = [];
	let currentPage = 1;
	const cardsPerPage = 10; // Adjust this number to ensure an even number of cards

	// Function to create cards dynamically
	function createCards(cardsData) {
		console.log("Displaying cards for page " + currentPage);
		console.log("Data passed to createCards: ", cardsData);
		const container = document.getElementById('card-container');
		container.innerHTML = ''; // Clear existing content

		// Calculate the start and end index for slicing the cardsData array
		const startIndex = (currentPage - 1) * cardsPerPage;
		const endIndex = startIndex + cardsPerPage;
		const paginatedItems = cardsData.slice(startIndex, endIndex);
		console.log("Cards on this page:", paginatedItems);

		paginatedItems.forEach(card => {
			// Create and append card elements as before
			const cardElement = document.createElement('div');
			cardElement.className = 'card';
			cardElement.style = "width: 100%; margin-bottom: 10px;";
			cardElement.innerHTML = `
            <div class="photo" style="height: 120px; background-position: center; background-repeat: no-repeat; background-size: cover; display: flex; justify-content: space-between; background-image: url('${card.imgSrc}');">
            </div>
            <div class="description" style="padding: 8px;">
                <div class="price" style="font-size: 1.2em; font-weight: bolder;">${card.price}</div>
                <div class="info" style="font-size: 0.75em;">${card.bedrooms} bds ${card.bathrooms} ba ${card.livingArea} sqft</div>
                <div class="address" style="font-size: 0.75em;">${card.address}</div>
            </div>
        `;
			container.appendChild(cardElement);
		});
	}

	// Function to fetch JSON data and extract specified fields from each item in 'props'
	async function fetchAndExtractData() {
		try {
			const response = await fetch('https://raw.githubusercontent.com/jeffrey840/zipcode_2/main/zillow_listings_77096_page1.json');
			if (!response.ok) {
				throw new Error(`HTTP error! status: ${response.status}`);
			}
			const data = await response.json();
			const extractedData = data.props.map(({ price, bedrooms, address, imgSrc, bathrooms, livingArea, currency, lotAreaUnit, daysOnZillow, propertyType }) =>
				({ price, bedrooms, address, imgSrc, bathrooms, livingArea, currency, lotAreaUnit, daysOnZillow, propertyType }));
			filteredData = extractedData;
			currentDisplayData = extractedData; // Initialize currentDisplayData
			createCards(currentDisplayData);
			console.log("Data fetched: ", extractedData);
		} catch (error) {
			console.error('Error fetching data: ', error);
		}
	}

	function filterByBathrooms(bathCount) {
		// Check if 'any' is selected, then don't filter by bathrooms
		const filtered = bathCount === 'any' ? filteredData : filteredData.filter(card => card.bathrooms === bathCount);
		createCards(filtered);
	}
	function filterByBedrooms(bedrooms) {
		// Check if 'any' is selected, then don't filter by bathrooms
		const filtered = bedrooms === 'any' ? filteredData : filteredData.filter(card => card.bedrooms === bedrooms);
		createCards(filtered);
	}
	// Call the fetchAndExtractData function when the DOM content is loaded
	document.addEventListener('DOMContentLoaded', fetchAndExtractData);

	function applyBedsBaths() {
		// Retrieve selected bedroom and bathroom values
		// This needs to be adapted based on your actual UI elements
		const selectedBedrooms = document.getElementById('bedroom-selector').value; // Replace with your actual element ID
		const selectedBathrooms = document.getElementById('bathroom-selector').value; // Replace with your actual element ID

		// Filter the listings
		const filteredListings = filteredData.filter(listing => {
			return (selectedBedrooms === 'any' || listing.bedrooms === parseInt(selectedBedrooms)) &&
				(selectedBathrooms === 'any' || listing.bathrooms === parseInt(selectedBathrooms));
		});

		// Update the display with filtered listings
		createCards(filteredListings);
	}

	function applyPriceRange() {
		const minPrice = parseInt($('#min-price').val()) || 0;
		const maxPrice = parseInt($('#max-price').val()) || Infinity;

		console.log("Selected Min Price: ", minPrice);
		console.log("Selected Max Price: ", maxPrice);

		const filteredListings = filteredData.filter(listing => {
			let listingPrice = listing.price;
			if (typeof listingPrice === 'string') {
				listingPrice = parseInt(listingPrice.replace(/[^0-9.-]+/g, ""));
			}

			return listingPrice >= minPrice && listingPrice <= maxPrice;
		});
		console.log("Filtered Listings (Price Range): ", filteredListings);
		filteredData = filteredListings;
		currentDisplayData = filteredListings;
		currentPage = 1;
		createCards(filteredListings);
	}


	function updateHomeType() {
		// Gather selected home types
		const selectedTypes = $('input[name="home-type"]:checked').map(function() {
			return this.value;
		}).get();

		// Filter listings based on selected home types
		const filteredListings = filteredData.filter(listing => selectedTypes.includes(listing.propertyType));

		// Update the card display
		createCards(filteredListings);
	}

	function applyHomeType() {
		const selectedTypes = [];
		$('input[name="home-type"]:checked').each(function() {
			selectedTypes.push($(this).val());
		});

		console.log("Selected Types: ", selectedTypes);

		const filteredListings = filteredData.filter(listing => {
			// Check if listing has a propertyType and if it's included in the selected types
			// If no propertyType, decide whether to include or exclude such listings
			return !listing.propertyType || selectedTypes.includes(listing.propertyType);
		});

		console.log("Filtered Listings: ", filteredListings);
		createCards(filteredListings);
	}

	function nextPage() {
		currentPage++;
		console.log("Next Page: ", currentPage);
		createCards(currentDisplayData);
	}

	function previousPage() {
		if (currentPage > 1) {
			currentPage--;
			console.log("Previous Page: ", currentPage);
			createCards(currentDisplayData);
		}
	}



	// Function to initialize Google Map
	function initMap() {
		const map = new google.maps.Map(document.getElementById('map-container'), {
			center: {lat: 29.760799, lng: -95.369507},
			zoom: 12
		});
	}
</script>

</body>
</html>
