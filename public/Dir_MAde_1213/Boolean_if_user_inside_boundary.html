<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GeoJSON, Turf.js, and Google Maps Example</title>
  <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADd7NKHfGXY1FLZn4z260m0pwnhFcA1gE"></script>
  <style>
    #map {
      height: 500px;
      width: 100%;
    }
    #checkLocationBtn {
      margin-top: 10px;
    }
  </style>
</head>
<body>
<div id="map"></div>
<button id="checkLocationBtn">Check My Location</button>
<script>
  let map;
  let geoJsonData;

  async function initMap() {
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: { lat: 29.7604, lng: -95.3698 } // Example coordinates (Houston, TX)
    });

    // Fetch and display GeoJSON overlay
    geoJsonData = await fetchGeoJson('https://raw.githubusercontent.com/jeffrey840/zipcode_2/main/Hcc_districts_Geojson/merged_districts.geojson');
    if (geoJsonData) {
      map.data.addGeoJson(geoJsonData);
    }
  }

  async function fetchGeoJson(url) {
    try {
      const response = await fetch(url);
      return await response.json();
    } catch (error) {
      console.error("Error fetching GeoJSON data:", error);
      return null;
    }
  }

  function checkPointInGeoJsonPolygon(pointCoordinates) {
    const polygon = geoJsonData.features[0].geometry;
    const point = turf.point(pointCoordinates);
    const isInside = turf.booleanPointInPolygon(point, polygon);

    // Create a marker for the point
    new google.maps.Marker({
      position: { lat: pointCoordinates[1], lng: pointCoordinates[0] },
      map: map,
      title: 'Your Location'
    });

    alert(`Is your current location inside the GeoJSON polygon? ${isInside}`);
  }

  function getUserLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((position) => {
        const pointCoordinates = [position.coords.longitude, position.coords.latitude];
        checkPointInGeoJsonPolygon(pointCoordinates);
      }, () => {
        alert('Error getting your location.');
      });
    } else {
      alert('Geolocation is not supported by this browser.');
    }
  }

  document.getElementById('checkLocationBtn').addEventListener('click', getUserLocation);

  initMap();
</script>
</body>
</html>
