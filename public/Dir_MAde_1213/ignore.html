<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
</head>
<body>

<script>


	let map;
	let markers = []; // Array to hold map markers
	let fetchController;
	let lastFetchTime = 0;
	let currentDistrict = ''; // Track the current district being loaded
	const districts = [
		// Districts data
	];

	function initialize() {
		console.log('Initializing map...');
		map = new google.maps.Map(document.getElementById('map'), {
			zoom: 12,
			center: { lat: 29.842912, lng: -95.323 } // Initial center
		});
		loadDistrictData('1'); // Load District 1 data initially
	}

	async function loadDistrictData(districtNumber) {
		console.log(`Loading data for District ${districtNumber}`);
		currentDistrict = districtNumber; // Set the current district
		if (fetchController) fetchController.abort(); // Abort any ongoing fetch requests
		fetchController = new AbortController(); // Create a new controller for the new request

		clearMarkers(); // Clear existing markers before loading new data
		map.data.forEach(feature => map.data.remove(feature)); // Clear existing GeoJSON overlays

		const selectedDistrict = districts.find(d => d.name === `District ${districtNumber}`);
		if (!selectedDistrict) {
			console.log(`District ${districtNumber} not found.`);
			return;
		}

		try {
			const districtGeoJson = await fetchGeoJson(selectedDistrict.geoJsonUrl, fetchController.signal);
			map.data.addGeoJson(districtGeoJson);
			map.data.setStyle({
				fillColor: 'blue',
				strokeWeight: 1
			});

			for (const zipCode of selectedDistrict.zipCodes) {
				// Check if still on the same district before fetching houses
				if (currentDistrict !== districtNumber) {
					console.log('Switched to a new district. Aborting fetch for the old district.');
					return;
				}
				await throttleFetch(() => fetchHouses(zipCode, districtGeoJson, fetchController.signal));
			}
		} catch (error) {
			console.error('Error during fetch:', error);
		}
	}

	// Function definitions for fetchHouses, displayHousesOnMap, clearMarkers, throttleFetch, fetchGeoJson, and delay

	function clearMarkers() {
		console.log('Clearing markers...');
		markers.forEach(marker => marker.setMap(null));
		markers = [];
	}
</script>
</body>
</html>