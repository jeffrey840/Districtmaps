<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Displaying the first 30 houses in zipcode</title>
	<script src="https://maps.googleapis.com/maps/api/js?key=&callback=initialize" async defer></script>
</head>

<body>

<div id="map" style="height: 500px; width: 100%;"></div>

<script>
	let map;

	function initMap(houses = []) {
		map = new google.maps.Map(document.getElementById('map'), {
			center: { lat: 29.8131, lng: -95.4648 }, // Rough coordinates for 77080
			zoom: 12
		});

		const redMarker = {
			path: google.maps.SymbolPath.CIRCLE,
			fillColor: 'red',
			fillOpacity: 1,
			scale: 5,
			strokeColor: 'red',
			strokeWeight: 1
		};

		houses.forEach(house => {
			new google.maps.Marker({
				position: { lat: house.latitude, lng: house.longitude },
				map: map,
				icon: redMarker
			});
		});
	}

	async function fetchHouses() {
		const url = 'https://zillow-com1.p.rapidapi.com/propertyExtendedSearch?location=77080&home_type=Houses';
		const options = {
			method: 'GET',
			headers: {
				'X-RapidAPI-Key': '',
				'X-RapidAPI-Host': 'zillow-com1.p.rapidapi.com'
			}
		};

		try {
			const response = await fetch(url, options);
			const data = await response.json();

			console.log(data);  // Log the entire response to check its structure

			if (data && data.props && data.props.length) {
				const houses = data.props.slice(0, 41).map(house => {
					return {
						latitude: house.latitude,
						longitude: house.longitude
					};
				});

				console.log('Displaying 30 houses:', houses);

				initMap(houses);
			} else {
				console.error('Unexpected response from Zillow API:', data);
			}
		} catch (error) {
			console.error(error);
		}
	}

	// Initialize function to be called when Google Maps API is ready
	function initialize() {
		fetchHouses();
	}

</script>
</body>

</html>
