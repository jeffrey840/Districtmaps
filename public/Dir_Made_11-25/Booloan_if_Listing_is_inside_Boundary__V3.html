<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>GeoJSON, Turf.js, and Google Maps Example</title>
	<script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADd7NKHfGXY1FLZn4z260m0pwnhFcA1gE&libraries=places"></script>
	<style>
        #map {
            height: 500px;
            width: 100%;
        }
        #searchBox {
            width: 300px;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            background-color: white;
            background-position: 10px 10px;
            background-repeat: no-repeat;
            padding: 12px 20px 12px 40px;
            margin: 10px 0;
        }
	</style>
</head>
<body>
<input id="searchBox" type="text" placeholder="Enter an address...">
<div id="map"></div>
<script>
	let map, marker, geoJsonData;

	function initMap(geoJsonData, pointCoordinates) {
		map = new google.maps.Map(document.getElementById('map'), {
			zoom: 12,
			center: { lat: pointCoordinates[1], lng: pointCoordinates[0] }
		});

		map.data.addGeoJson(geoJsonData);

		marker = new google.maps.Marker({
			position: { lat: pointCoordinates[1], lng: pointCoordinates[0] },
			map: map,
			title: 'Point Location'
		});
	}

	async function fetchGeoJson(url) {
		try {
			const response = await fetch(url);
			return await response.json();
		} catch (error) {
			console.error("Error fetching GeoJSON data:", error);
			return null;
		}
	}

	// JavaScript code modifications...

	async function checkPointInGeoJsonPolygon(geoJsonData, pointCoordinates) {
		if (geoJsonData && geoJsonData.features) {
			const polygon = geoJsonData.features[0].geometry;
			const point = turf.point(pointCoordinates);
			const isInside = turf.booleanPointInPolygon(point, polygon);

			if (!marker) {
				// Create a marker if it doesn't exist
				marker = new google.maps.Marker({
					position: { lat: pointCoordinates[1], lng: pointCoordinates[0] },
					map: map,
					title: 'Point Location'
				});
			} else {
				// Update the marker's position if it already exists
				marker.setPosition({ lat: pointCoordinates[1], lng: pointCoordinates[0] });
			}

			alert(isInside ? "is within bounds" : "outside bounds");
		} else {
			alert('Failed to load or process GeoJSON data.');
		}
	}

	async function handleSearchInput(e) {
		if (e.key === 'Enter') {
			const address = document.getElementById('searchBox').value;
			const geocoder = new google.maps.Geocoder();

			try {
				const location = await geocodeAddress(geocoder, address);
				const pointCoordinates = [location.lng(), location.lat()];

				// Ensure GeoJSON data is loaded before proceeding
				if (geoJsonData) {
					checkPointInGeoJsonPolygon(geoJsonData, pointCoordinates);
				} else {
					alert("GeoJSON data is not yet loaded. Please try again.");
				}
			} catch (error) {
				alert(error);
			}
		}
	}




	async function geocodeAddress(geocoder, address) {
		return new Promise((resolve, reject) => {
			geocoder.geocode({ 'address': address }, (results, status) => {
				if (status === 'OK') {
					resolve(results[0].geometry.location);
				} else {
					reject('Geocode was not successful for the following reason: ' + status);
				}
			});
		});
	}

	document.getElementById('searchBox').addEventListener('keydown', handleSearchInput);

	const geoJsonUrl = 'https://raw.githubusercontent.com/jeffrey840/zipcode_2/main/Hcc_districts_Geojson/merged_districts.geojson';

	fetchGeoJson(geoJsonUrl).then(data => geoJsonData = data);
</script>
</body>
</html>
