<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GeoJSON, Turf.js, and Google Maps Example</title>
  <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyADd7NKHfGXY1FLZn4z260m0pwnhFcA1gE"></script>
  <style>
    #map {
      height: 500px;
      width: 100%;
    }
  </style>
</head>
<body>
<div id="map"></div>
<script>
  let map;

  function initMap(geoJsonData, pointCoordinates) {
    // Initialize the map centered on the point
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 12,
      center: { lat: pointCoordinates[1], lng: pointCoordinates[0] }
    });

    // Display the GeoJSON polygon on the map
    map.data.addGeoJson(geoJsonData);

    // Create a marker for the point
    new google.maps.Marker({
      position: { lat: pointCoordinates[1], lng: pointCoordinates[0] },
      map: map,
      title: 'Your Location'
    });
  }

  async function fetchGeoJson(url) {
    try {
      const response = await fetch(url);
      return await response.json();
    } catch (error) {
      console.error("Error fetching GeoJSON data:", error);
      return null;
    }
  }

  function checkPointInGeoJsonPolygon(geoJsonData, pointCoordinates) {
    const polygon = geoJsonData.features[0].geometry;
    const point = turf.point(pointCoordinates);
    const isInside = turf.booleanPointInPolygon(point, polygon);

    // Initialize the map with the GeoJSON data and the point
    initMap(geoJsonData, pointCoordinates);

    alert(`Is your current location inside the GeoJSON polygon? ${isInside}`);
  }

  function getUserLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (position) => {
        const pointCoordinates = [position.coords.longitude, position.coords.latitude];
        const geoJsonData = await fetchGeoJson('https://raw.githubusercontent.com/jeffrey840/zipcode_2/main/Hcc_districts_Geojson/merged_districts.geojson');

        if (geoJsonData) {
          checkPointInGeoJsonPolygon(geoJsonData, pointCoordinates);
        } else {
          alert('Failed to load or process GeoJSON data.');
        }
      }, () => {
        alert('Error getting your location.');
      });
    } else {
      alert('Geolocation is not supported by this browser.');
    }
  }

  getUserLocation();
</script>
</body>
</html>
