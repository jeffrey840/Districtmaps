<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Displaying houses by zipcode</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=&callback=initialize" async defer></script>
</head>

<body>

<!-- Zipcode Buttons -->
<div id="zipcodeButtons">
  <button onclick="fetchHouses('77080', 1)">77080</button>
  <button onclick="fetchHouses('77056', 1)">77056</button>
</div>

<!-- Map Component -->
<div id="map" style="height: 500px; width: 100%;"></div>

<!-- Pagination Component -->
<div id="pagination"></div>

<script>
  let map;
  let currentZipCode = '77080'; // Default Zipcode
  const defaultLatLng = { lat: 29.8131, lng: -95.4648 }; // Default coordinates for 77080

  function initMap(houses = [], center = defaultLatLng) {
    map = new google.maps.Map(document.getElementById('map'), {
      center: center,
      zoom: 12
    });

    const redMarker = {
      path: google.maps.SymbolPath.CIRCLE,
      fillColor: 'red',
      fillOpacity: 1,
      scale: 5,
      strokeColor: 'red',
      strokeWeight: 1
    };

    houses.forEach(house => {
      new google.maps.Marker({
        position: { lat: house.latitude, lng: house.longitude },
        map: map,
        icon: redMarker
      });
    });
  }

  async function fetchHouses(zipCode, page = 1) {
    currentZipCode = zipCode;
    const url = `https://zillow-com1.p.rapidapi.com/propertyExtendedSearch?location=${zipCode}&home_type=Houses&page=${page}`;
    const options = {
      method: 'GET',
      headers: {
        'X-RapidAPI-Key': '', // replace with your key
        'X-RapidAPI-Host': 'zillow-com1.p.rapidapi.com'
      }
    };

    try {
      const response = await fetch(url, options);
      const data = await response.json();

      if (data && data.props && data.props.length) {
        const houses = data.props.map(house => {
          return {
            latitude: house.latitude,
            longitude: house.longitude
          };
        });

        initMap(houses);
        handlePagination(data.totalPages);
      } else {
        console.error('Unexpected response from Zillow API:', data);
      }
    } catch (error) {
      console.error(error);
    }
  }

  function handlePagination(totalPages) {
    const paginationContainer = document.getElementById('pagination');
    paginationContainer.innerHTML = '';  // Clear existing buttons
    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement('button');
      btn.innerHTML = i;
      btn.onclick = () => fetchHouses(currentZipCode, i);
      paginationContainer.appendChild(btn);
    }
  }

  function initialize() {
    fetchHouses(currentZipCode, 1);
  }

</script>
</body>
</html>
